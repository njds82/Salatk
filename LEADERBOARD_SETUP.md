# ุฏููู ุฅุนุฏุงุฏ ููุญุฉ ุงููุชุตุฏุฑูู - Salatk

## ๐ ุงููุดููุฉ

ููุญุฉ ุงููุชุตุฏุฑูู ูุง ุชุนุฑุถ ุฃู ุจูุงูุงุช ูุฃู **View** ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ููุฌูุฏ ูู Supabase.

## โ ุงูุญู

ูุฌุจ ุชุดุบูู ุณูุฑูุจุช SQL ูุฅูุดุงุก View ูุญุณุจ ุชุฑุชูุจ ุงููุณุชุฎุฏููู ุจูุงุกู ุนูู ููุงุทูู.

---

## ๐ ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### ุงูุฎุทูุฉ 1: ุงููุตูู ุฅูู Supabase Dashboard

1. ุงูุชุญ ูุชุตูุญู ูุงูุชูู ุฅูู: [https://supabase.com/dashboard](https://supabase.com/dashboard)
2. ุณุฌู ุฏุฎููู ุฅูู ุญุณุงุจู
3. ุงุฎุชุฑ ุงููุดุฑูุน: **xdvnweeorbuqmrgbtxuu**

### ุงูุฎุทูุฉ 2: ูุชุญ SQL Editor

1. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุถุบุท ุนูู **SQL Editor**
2. ุงุถุบุท ุนูู **New Query** ูุฅูุดุงุก ุงุณุชุนูุงู ุฌุฏูุฏ

### ุงูุฎุทูุฉ 3: ุชุดุบูู ุงูุณูุฑูุจุช

1. ุงูุชุญ ุงูููู: [`supabase_leaderboard_view.sql`](file:///home/loid/code/salatk/supabase_leaderboard_view.sql)
2. ุงูุณุฎ ูุญุชูู ุงูููู ุจุงููุงูู
3. ุงูุตู ุงููุญุชูู ูู SQL Editor
4. ุงุถุบุท ุนูู **Run** ุฃู **Ctrl+Enter**

### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงููุฌุงุญ

ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ูุฌุงุญ ูุซู:
```
Success. No rows returned
```

---

## ๐ ูุง ุงูุฐู ููุนูู ุงูุณูุฑูุจุชุ

ุงูุณูุฑูุจุช ููุดุฆ **View** ุงุณูู `leaderboard` ูููู ุจู:

1. **ุฌูุน ุงูููุงุท:** ูุญุณุจ ูุฌููุน ููุงุท ูู ูุณุชุฎุฏู ูู ุฌุฏูู `points_history`
2. **ุงูุชุฑุชูุจ:** ูุฑุชุจ ุงููุณุชุฎุฏููู ุญุณุจ ุงูููุงุท (ุงูุฃุนูู ุฃููุงู)
3. **ุฅุถุงูุฉ ุงูุฑุชุจุฉ:** ูุนุทู ูู ูุณุชุฎุฏู ุฑูู ุชุฑุชูุจ
4. **ุงูููุชุฑุฉ:** ูุนุฑุถ ููุท ุงููุณุชุฎุฏููู ุงูุฐูู ูุฏููู ููุงุท

### ุจููุฉ ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:

| ุงูุนููุฏ | ุงููุตู |
|--------|-------|
| `ranking` | ุฑูู ุงูุชุฑุชูุจ (1ุ 2ุ 3...) |
| `user_id` | ูุนุฑูู ุงููุณุชุฎุฏู |
| `email` | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู |
| `full_name` | ุงูุงุณู ุงููุงูู (ูู ุงูุจูุงูุงุช ุงููุตููุฉ ุฃู ุงูุจุฑูุฏ) |
| `total_points` | ูุฌููุน ุงูููุงุท |
| `total_activities` | ุนุฏุฏ ุงูุฃูุดุทุฉ |

---

## ๐งช ุงุฎุชุจุงุฑ ููุญุฉ ุงููุชุตุฏุฑูู

ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุช:

1. ุงูุชุญ ุงูุชุทุจูู: `http://localhost:8080`
2. ุณุฌู ุฏุฎููู (ุฅุฐุง ูู ุชูู ูุณุฌูุงู)
3. ุงูุชูู ุฅูู **ููุญุฉ ุงูุตุฏุงุฑุฉ** ูู ุงููุงุฆูุฉ
4. ูุฌุจ ุฃู ุชุฑู ูุงุฆูุฉ ุงููุณุชุฎุฏููู ูุฑุชุจุฉ ุญุณุจ ุงูููุงุท

### ุฅุฐุง ูู ุชุธูุฑ ุจูุงูุงุช:

**ุงูุณุจุจ ุงููุญุชูู:** ูุง ููุฌุฏ ูุณุชุฎุฏููู ูุฏููู ููุงุท ุจุนุฏ.

**ุงูุญู:**
1. ูู ุจุจุนุถ ุงูุฃูุดุทุฉ (ุตูููุ ุฃุถู ุนุงุฏุงุชุ ุฅูุฎ)
2. ุชุฃูุฏ ูู ุฃู ุงูููุงุท ุชูุณุฌู ูู ุฌุฏูู `points_history`
3. ุฃุนุฏ ุชุญููู ููุญุฉ ุงููุชุตุฏุฑูู

---

## ๐ง ุงูุชุญูู ูู ุงูุจูุงูุงุช ูู Supabase

### ุทุฑููุฉ 1: Table Editor

1. ุงุฐูุจ ุฅูู **Table Editor** ูู Supabase
2. ุงุฎุชุฑ ุฌุฏูู `points_history`
3. ุชุญูู ูู ูุฌูุฏ ุณุฌูุงุช

### ุทุฑููุฉ 2: SQL Query

ูู ุจุชุดุบูู ูุฐุง ุงูุงุณุชุนูุงู ูู SQL Editor:

```sql
-- ุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู ูููุงุทูู
SELECT * FROM leaderboard;

-- ุนุฑุถ ุฃูู 10 ูุชุตุฏุฑูู
SELECT * FROM leaderboard LIMIT 10;

-- ุนุฑุถ ุนุฏุฏ ุงููุณุชุฎุฏููู ูู ููุญุฉ ุงููุชุตุฏุฑูู
SELECT COUNT(*) as total_users FROM leaderboard;
```

---

## โ๏ธ ุฑุณุงุฆู ุงูุฎุทุฃ ุงููุญุชููุฉ

### ุฎุทุฃ: "relation 'leaderboard' does not exist"

**ุงูุณุจุจ:** ูู ูุชู ุชุดุบูู ุณูุฑูุจุช SQL ุจุนุฏ.

**ุงูุญู:** ุงุชุจุน ุงูุฎุทูุงุช ุฃุนูุงู ูุชุดุบูู `supabase_leaderboard_view.sql`

### ุฎุทุฃ: "permission denied for table auth.users"

**ุงูุณุจุจ:** ูุดููุฉ ูู ุงูุตูุงุญูุงุช.

**ุงูุญู:** ุชุฃูุฏ ูู ุฃูู ุชุณุชุฎุฏู ุญุณุงุจ Admin ูู Supabase Dashboard.

### ุฎุทุฃ: "ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูุนุฑุถ ููุญุฉ ุงููุชุตุฏุฑูู"

**ุงูุณุจุจ:** ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุฏุฎูู.

**ุงูุญู:** ุณุฌู ุฏุฎููู ุฃููุงู ูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู.

---

## ๐ ููู ุชุนูู ููุญุฉ ุงููุชุตุฏุฑููุ

### ุชุฏูู ุงูุจูุงูุงุช:

```
ุงููุณุชุฎุฏู ูุคุฏู ูุดุงุท (ุตูุงุฉุ ุนุงุฏุฉุ ุฅูุฎ)
    โ
PointsService.addPoints()
    โ
ุชูุถุงู ููุงุท ุฅูู ุฌุฏูู points_history
    โ
View leaderboard ููุญุฏูุซ ุชููุงุฆูุงู
    โ
ุตูุญุฉ ููุญุฉ ุงููุชุตุฏุฑูู ุชุนุฑุถ ุงูุจูุงูุงุช ุงููุญุฏุซุฉ
```

### ุงูุชุญุฏูุซ ุงูุชููุงุฆู:

- **View** ููุญุฏูุซ ุชููุงุฆูุงู ุนูุฏ ุฃู ุชุบููุฑ ูู `points_history`
- ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุดุบูู ุฃู ุดูุก
- ุงูุจูุงูุงุช ุฏุงุฆูุงู ูุญุฏุซุฉ

---

## ๐จ ุงูุชุญุณููุงุช ุงูููุทุจูุฉ

### 1. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงููุญุณููุฉ

ุงูููุฏ ุงูุขู ูุชุนุงูู ูุน:
- โ ุนุฏู ูุฌูุฏ View
- โ ุนุฏู ุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏู
- โ ุฃุฎุทุงุก ุงูุดุจูุฉ
- โ ุนุฏู ูุฌูุฏ ุจูุงูุงุช

### 2. ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

ุนูุฏ ุญุฏูุซ ุฎุทุฃุ ูุฑู ุงููุณุชุฎุฏู:
- ๐ฏ ูุตู ูุงุถุญ ูููุดููุฉ
- ๐ ุฎุทูุงุช ุงูุฅุตูุงุญ ุงูุชูุตูููุฉ
- ๐ก ูุตุงุฆุญ ูููุฏุฉ

### 3. ุชุณุฌูู ุชูุตููู (Logging)

ุงูููุฏ ูุณุฌู ูู Console:
```javascript
console.log('Leaderboard data fetched:', leaderboardData.length, 'users');
console.error('Error fetching leaderboard:', error);
```

---

## ๐ ุงูุฃูุงู (RLS)

View ููุญุฉ ุงููุชุตุฏุฑูู:
- โ ูุชุงุญ ูุฌููุน ุงููุณุชุฎุฏููู ุงููุณุฌููู
- โ ูุนุฑุถ ููุท ุงูุจูุงูุงุช ุงูุนุงูุฉ (ุงูุงุณูุ ุงูููุงุท)
- โ ูุง ูุนุฑุถ ุจูุงูุงุช ุญุณุงุณุฉ

ุงูุตูุงุญูุงุช:
```sql
GRANT SELECT ON leaderboard TO authenticated;
```

---

## ๐ ุงูุฃุฏุงุก

### View vs Materialized View

**ุงูุญุงูู:** ุงุณุชุฎุฏุงู View ุนุงุฏู
- โ ููุญุฏูุซ ุชููุงุฆูุงู
- โ ุจูุงูุงุช ุฏุงุฆูุงู ูุญุฏุซุฉ
- โ๏ธ ูุฏ ูููู ุจุทูุฆุงู ูุน ุขูุงู ุงููุณุชุฎุฏููู

**ูููุณุชูุจู:** ุฅุฐุง ูุงู ุนุฏุฏ ุงููุณุชุฎุฏููู ูุจูุฑ ุฌุฏุงู:
```sql
-- ุงุณุชุฎุฏู Materialized View
CREATE MATERIALIZED VIEW leaderboard_materialized AS ...

-- ุญุฏูุซู ูู ุณุงุนุฉ
REFRESH MATERIALIZED VIEW leaderboard_materialized;
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

ูุจู ุฃู ุชุนุชุจุฑ ููุญุฉ ุงููุชุตุฏุฑูู ุฌุงูุฒุฉ:

- [ ] ุชู ุชุดุบูู `supabase_leaderboard_view.sql` ูู Supabase
- [ ] View `leaderboard` ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [ ] ููุฌุฏ ูุณุชุฎุฏููู ูุฏููู ููุงุท ูู `points_history`
- [ ] ุตูุญุฉ ููุญุฉ ุงููุชุตุฏุฑูู ุชุนุฑุถ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
- [ ] ุฑุณุงุฆู ุงูุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุตูุญุฉ ูุน ูุณุชุฎุฏููู ูุชุนุฏุฏูู

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:

1. **ุชุญูู ูู Console:** ุงูุชุญ Developer Tools (F12) ูุฑุงุฌุน ุฑุณุงุฆู ุงูุฎุทุฃ
2. **ุชุญูู ูู Supabase Logs:** ูู Dashboard โ Logs
3. **ุงุฎุชุจุฑ ุงูุงุณุชุนูุงู ูุฏููุงู:** ูู SQL Editor

---

*ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ููุณุงุนุฏุชู ูู ุฅุนุฏุงุฏ ููุญุฉ ุงููุชุตุฏุฑูู ุจูุฌุงุญ* โจ
